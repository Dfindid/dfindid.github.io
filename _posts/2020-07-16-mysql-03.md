---
layout: post
title: 'Mysql各种锁机制（python）'
date: 2020-07-18
author: liqi
cover: 'assets/img/1.jpg'
tags: Mysql python
---

### 1.为什么要用锁？什么样的业务场景下需要用锁？

>就拿之前的工单系统来说，当审批方式为角色组审批时，代表该角色组内任意一人审批即可，这时，该角色组内成员的系统上都是可以显示审批按钮，如果此时A审批员和B审批员都同时审批了同一工单，有可能会出现不一样的审批结果，即使审批意见是一致的，多人操作也会增加对数据库的操作次数，同时也消耗了很大时间成本，用了锁机制，确保这部分是只一人在操作。

 

### 2.你知道MySQL有哪些锁？

>悲观锁、乐观锁            排它锁、共享锁                 行级锁、表级锁

 
#### 悲观锁：
>对每次访问数据库的操作都是抱有悲观的态度，认为该操作会对数据库做出修改，所以在访问数据库的时候就加了锁; 
>数据对外界的修改采取保守策略，它认为线程很容易会把数据修改掉，因此在整个数据被修改的过程中都会采取锁定状态，直到一个线程使用完，其他线程才可以继续使用。
>缺点：容易造成**死锁**。

#### 死锁（悲观锁几率造成）：
>**死锁**是指两个线程同时占用两个资源，又在彼此等待对方释放锁资源 

#### 乐观锁：
>对每次访问数据库的操作都抱有乐观的态度，只有在做出修改的时候才会上锁
》乐观锁和悲观锁的概念恰好相反，乐观锁认为一般情况下数据在修改时不会出现冲突，所以在数据访问之前不会加锁，只是在数据提交更改时，才会对数据进行检测上锁。

 

#### 排它锁：
>也称为写锁，若事务A对数据A上了写锁，那么此时只允许事务A对数据A进行读和写的操作，不允许数据A再接受其他的锁，直到排它锁释放之后

#### 共享锁：
>也称为读锁，若事务A对数据A上了读锁，那么此时事务A只能读取数据A并不能对其修改，也能接受其他事务对数据A的读锁

 

 

### 3.mysql数据库引擎：MyISAM 和 InnoDB

#### MyISAM 采用表级锁，不支持事务

#### InnoDB 默认行级锁，也支持表级锁

>1.行级锁：如根据主键id字段进行查找，并且查找到数据，主键字段就产生了行级锁

>2.表级锁：根据非主键非索引字段进行查找，并且查找到数据，当前查找字段产生表级锁

 

### 4.GIL全局解释器锁：
>GIL相当于互斥锁，在解释器层面上限制多线程同时执行，避免争抢资源，保证同一时间只有一个线程在执行

 
### 5.有了GIL全局解释器锁，为什么还要线程锁？

>因为cpu是分时分片的  当该协程指定时间内未完成任务时 需要用到线程锁 
